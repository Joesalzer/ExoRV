num_pixels = dim(solar_spectrum$flux)[1]
num_orders = dim(solar_spectrum$flux)[2]
# vector of orders and pixels
orders = seq(1,num_orders) %>% map_chr( \(x) str_c("order",x) )
pixels = seq(1,num_pixels)
# create dataframe for orders and pixels
solar_spectrum.df = expand_grid(order = orders, pixel = pixels)
# set columns
solar_spectrum.df$flux_norm = as.vector(solar_spectrum$flux_norm)
solar_spectrum.df$flux = as.vector(solar_spectrum$flux)
solar_spectrum.df$lambda = as.vector(solar_spectrum$lambda)
solar_spectrum.df$var = as.vector(solar_spectrum$var)
solar_spectrum.df$var_norm = as.vector(solar_spectrum$var_norm)
# remove some vectors
rm(orders, pixels, num_orders, num_pixels)
solar_spectrum.df
#line_name = "line_5236.09361_57.h5"
line_name = "line_6126.72717_74.h5"
# download a single line
# (pixels,date)
single_line = H5Fopen(str_c(wd_data, line_name))
single_line
single_line$pixels
single_line$order_idx
single_line$fit_lambdac
# vector of dates
dates = single_line$dates
# vector of pixels
pixels = as.numeric( str_split_1(single_line$pixels,":") )
pixels = seq(pixels[1],pixels[2])
# create dataframe for dates and pixels
single_line.df = expand_grid(date = dates, pixel = pixels )
# set columns
single_line.df$flux = as.vector( single_line$flux)
single_line.df$flux_norm = as.vector( single_line$flux_norm)
single_line.df$lambda = as.vector( single_line$lambda)
single_line.df$var = as.vector( single_line$var)
single_line.df$var_norm = as.vector( single_line$var_norm)
rm(dates, pixels)
single_line$pixels
single_line$order_idx
single_line$fit_lambdac
str_c("order",single_line$order_idx)
str_split(single_line$pixels,":")
str_split1(single_line$pixels,":")
str_split_1(single_line$pixels,":")
str_split_1(single_line$pixels,":")[0]
str_split_1(single_line$pixels,":")[1]
as.numeric( str_split_1(single_line$pixels,":")[1] )
solar_spectrum.df %>%
filter(order == str_c("order",single_line$order_idx),
pixel >= as.numeric( str_split_1(single_line$pixels,":")[1] ),
pixel <= as.numeric( str_split_1(single_line$pixels,":")[2] )) %>%
ggplot(mapping = aes(x = lambda, y = flux_norm)) +
#geom_vline(xintercept = (solar_spectrum.df %>% filter(order == "order57", pixel == 2491))$lambda) +
#geom_vline(xintercept = (solar_spectrum.df %>% filter(order == "order57", pixel == 2500))$lambda) +
geom_point()
single_line.df%>%
#mutate(date = as.Date(date), date = as.numeric(date)) %>%
filter(date == "2021-06-20") %>%
ggplot(mapping = aes(x = pixel, y = flux_norm, color = date)) +
geom_point()
# lower and upper pixel
pixel_lower = as.numeric( str_split_1(single_line$pixels,":")[1] )
pixel_upper = as.numeric( str_split_1(single_line$pixels,":")[2] )
solar_spectrum.df %>%
filter(order == str_c("order",single_line$order_idx),
pixel >= pixel_lower - 10,
pixel <= pixel_upper + 10) %>%
ggplot(mapping = aes(x = lambda, y = flux_norm)) +
geom_vline(xintercept = (solar_spectrum.df %>% filter(order == str_c("order",single_line$order_idx),
pixel == pixel_lower))$lambda) +
geom_vline(xintercept = (solar_spectrum.df %>% filter(order == str_c("order",single_line$order_idx),
pixel == pixel_upper))$lambda) +
geom_point()
# lower and upper pixel
pixel_lower = as.numeric( str_split_1(single_line$pixels,":")[1] )
pixel_upper = as.numeric( str_split_1(single_line$pixels,":")[2] )
solar_spectrum.df %>%
filter(order == str_c("order",single_line$order_idx),
pixel >= pixel_lower - 20,
pixel <= pixel_upper + 20) %>%
ggplot(mapping = aes(x = lambda, y = flux_norm)) +
geom_vline(xintercept = (solar_spectrum.df %>% filter(order == str_c("order",single_line$order_idx),
pixel == pixel_lower))$lambda) +
geom_vline(xintercept = (solar_spectrum.df %>% filter(order == str_c("order",single_line$order_idx),
pixel == pixel_upper))$lambda) +
geom_point()
line_name = "line_5236.09361_57.h5"
#line_name = "line_6126.72717_74.h5"
# download a single line
# (pixels,date)
single_line = H5Fopen(str_c(wd_data, line_name))
single_line
single_line$pixels
single_line$order_idx
single_line$fit_lambdac
# vector of dates
dates = single_line$dates
# vector of pixels
pixels = as.numeric( str_split_1(single_line$pixels,":") )
pixels = seq(pixels[1],pixels[2])
# create dataframe for dates and pixels
single_line.df = expand_grid(date = dates, pixel = pixels )
# set columns
single_line.df$flux = as.vector( single_line$flux)
single_line.df$flux_norm = as.vector( single_line$flux_norm)
single_line.df$lambda = as.vector( single_line$lambda)
single_line.df$var = as.vector( single_line$var)
single_line.df$var_norm = as.vector( single_line$var_norm)
rm(dates, pixels)
solar_spectrum.df %>% filter(order == "order57",pixel == 2491)
single_line.df %>% filter(pixel == 2491)
# lower and upper pixel
pixel_lower = as.numeric( str_split_1(single_line$pixels,":")[1] )
pixel_upper = as.numeric( str_split_1(single_line$pixels,":")[2] )
solar_spectrum.df %>%
filter(order == str_c("order",single_line$order_idx),
pixel >= pixel_lower - 20,
pixel <= pixel_upper + 20) %>%
ggplot(mapping = aes(x = lambda, y = flux_norm)) +
geom_vline(xintercept = (solar_spectrum.df %>% filter(order == str_c("order",single_line$order_idx),
pixel == pixel_lower))$lambda) +
geom_vline(xintercept = (solar_spectrum.df %>% filter(order == str_c("order",single_line$order_idx),
pixel == pixel_upper))$lambda) +
geom_point()
# lower and upper pixel
pixel_lower = as.numeric( str_split_1(single_line$pixels,":")[1] )
pixel_upper = as.numeric( str_split_1(single_line$pixels,":")[2] )
solar_spectrum.df %>%
filter(order == str_c("order",single_line$order_idx),
pixel >= pixel_lower - 50,
pixel <= pixel_upper + 50) %>%
ggplot(mapping = aes(x = lambda, y = flux_norm)) +
geom_vline(xintercept = (solar_spectrum.df %>% filter(order == str_c("order",single_line$order_idx),
pixel == pixel_lower))$lambda) +
geom_vline(xintercept = (solar_spectrum.df %>% filter(order == str_c("order",single_line$order_idx),
pixel == pixel_upper))$lambda) +
geom_point()
# lower and upper pixel
pixel_lower = as.numeric( str_split_1(single_line$pixels,":")[1] )
pixel_upper = as.numeric( str_split_1(single_line$pixels,":")[2] )
ordernum = str_c("order",single_line$order_idx)
solar_spectrum.df %>%
filter(order == ordernum,
pixel >= pixel_lower - 50,
pixel <= pixel_upper + 50) %>%
ggplot(mapping = aes(x = lambda, y = flux_norm)) +
geom_vline(xintercept = (solar_spectrum.df %>% filter(order == ordernum,
pixel == pixel_lower))$lambda) +
geom_vline(xintercept = (solar_spectrum.df %>% filter(order == ordernum,
pixel == pixel_upper))$lambda) +
geom_point()
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(stringr)
library(MASS)
library(rhdf5)
## Data directory
wd_data = "/Users/josephsalzer/research/exostat/"
# download solar spectrum, with flux, flux_norm, lambda, var, and var_norm
# (pixels,order_idx)
solar_spectrum = H5Fopen(str_c(wd_data, "solar_spectrum_ex.h5"))
solar_spectrum
solar_spectrum$flux_norm[1:6,1:10]
# number of pixels and orders
num_pixels = dim(solar_spectrum$flux)[1]
num_orders = dim(solar_spectrum$flux)[2]
# vector of orders and pixels
orders = seq(1,num_orders) %>% map_chr( \(x) str_c("order",x) )
pixels = seq(1,num_pixels)
# create dataframe for orders and pixels
solar_spectrum.df = expand_grid(order = orders, pixel = pixels)
# set columns
solar_spectrum.df$flux_norm = as.vector(solar_spectrum$flux_norm)
solar_spectrum.df$flux = as.vector(solar_spectrum$flux)
solar_spectrum.df$lambda = as.vector(solar_spectrum$lambda)
solar_spectrum.df$var = as.vector(solar_spectrum$var)
solar_spectrum.df$var_norm = as.vector(solar_spectrum$var_norm)
# remove some vectors
rm(orders, pixels, num_orders, num_pixels)
solar_spectrum.df
line_name = "line_5236.09361_57.h5"
#line_name = "line_6126.72717_74.h5"
# download a single line
# (pixels,date)
single_line = H5Fopen(str_c(wd_data, line_name))
single_line
single_line$pixels
single_line$order_idx
single_line$fit_lambdac
# vector of dates
dates = single_line$dates
# vector of pixels
pixels = as.numeric( str_split_1(single_line$pixels,":") )
pixels = seq(pixels[1],pixels[2])
# create dataframe for dates and pixels
single_line.df = expand_grid(date = dates, pixel = pixels )
# set columns
single_line.df$flux = as.vector( single_line$flux)
single_line.df$flux_norm = as.vector( single_line$flux_norm)
single_line.df$lambda = as.vector( single_line$lambda)
single_line.df$var = as.vector( single_line$var)
single_line.df$var_norm = as.vector( single_line$var_norm)
rm(dates, pixels)
solar_spectrum.df %>% filter(order == "order57",pixel == 2491)
single_line.df %>% filter(pixel == 2491)
solar_spectrum.df %>%
filter(order == "order52") %>%
ggplot(mapping = aes(x = lambda, y = flux)) +
geom_point()
solar_spectrum.df %>%
filter(order == "order52") %>%
ggplot(mapping = aes(x = lambda, y = flux_norm)) +
geom_point()
# lower and upper pixel
pixel_lower = as.numeric( str_split_1(single_line$pixels,":")[1] )
pixel_upper = as.numeric( str_split_1(single_line$pixels,":")[2] )
ordernum = str_c("order",single_line$order_idx)
solar_spectrum.df %>%
filter(order == ordernum,
pixel >= pixel_lower - 50,
pixel <= pixel_upper + 50) %>%
ggplot(mapping = aes(x = lambda, y = flux_norm)) +
geom_vline(xintercept = (solar_spectrum.df %>% filter(order == ordernum,
pixel == pixel_lower))$lambda) +
geom_vline(xintercept = (solar_spectrum.df %>% filter(order == ordernum,
pixel == pixel_upper))$lambda) +
geom_point()
rm(pixel_lower, pixel_upper, ordernum)
solar_spectrum.df %>%
filter(order == "order52") %>%
ggplot(mapping = aes(x = lambda, y = flux)) +
geom_point() +
geom_line()
solar_spectrum.df %>%
filter(order == "order52") %>%
ggplot(mapping = aes(x = lambda, y = flux)) +
geom_point()
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(stringr)
library(MASS)
library(rhdf5)
## Data directory
wd_data = "/Users/josephsalzer/research/exostat/"
# download solar spectrum, with flux, flux_norm, lambda, var, and var_norm
# (pixels,order_idx)
solar_spectrum = H5Fopen(str_c(wd_data, "solar_spectrum_ex.h5"))
solar_spectrum
solar_spectrum$flux_norm[1:6,1:10]
# number of pixels and orders
num_pixels = dim(solar_spectrum$flux)[1]
num_orders = dim(solar_spectrum$flux)[2]
# vector of orders and pixels
orders = seq(1,num_orders) %>% map_chr( \(x) str_c("order",x) )
pixels = seq(1,num_pixels)
# create dataframe for orders and pixels
solar_spectrum.df = expand_grid(order = orders, pixel = pixels)
# set columns
solar_spectrum.df$flux_norm = as.vector(solar_spectrum$flux_norm)
solar_spectrum.df$flux = as.vector(solar_spectrum$flux)
solar_spectrum.df$lambda = as.vector(solar_spectrum$lambda)
solar_spectrum.df$var = as.vector(solar_spectrum$var)
solar_spectrum.df$var_norm = as.vector(solar_spectrum$var_norm)
# remove some vectors
rm(orders, pixels, num_orders, num_pixels)
solar_spectrum.df
#line_name = "line_5236.09361_57.h5"
#line_name = "line_6126.72717_74.h5"
line_name = "line_9864.45699_112.h5"
# download a single line
# (pixels,date)
single_line = H5Fopen(str_c(wd_data, line_name))
single_line
single_line$pixels
single_line$order_idx
single_line$fit_lambdac
# vector of dates
dates = single_line$dates
# vector of pixels
pixels = as.numeric( str_split_1(single_line$pixels,":") )
pixels = seq(pixels[1],pixels[2])
# create dataframe for dates and pixels
single_line.df = expand_grid(date = dates, pixel = pixels )
# set columns
single_line.df$flux = as.vector( single_line$flux)
single_line.df$flux_norm = as.vector( single_line$flux_norm)
single_line.df$lambda = as.vector( single_line$lambda)
single_line.df$var = as.vector( single_line$var)
single_line.df$var_norm = as.vector( single_line$var_norm)
rm(dates, pixels)
solar_spectrum.df %>% filter(order == "order57",pixel == 2491)
single_line.df %>% filter(pixel == 2491)
solar_spectrum.df %>%
filter(order == "order52") %>%
ggplot(mapping = aes(x = lambda, y = flux)) +
geom_point()
solar_spectrum.df %>%
filter(order == "order52") %>%
ggplot(mapping = aes(x = lambda, y = flux_norm)) +
geom_point()
# lower and upper pixel
pixel_lower = as.numeric( str_split_1(single_line$pixels,":")[1] )
pixel_upper = as.numeric( str_split_1(single_line$pixels,":")[2] )
ordernum = str_c("order",single_line$order_idx)
solar_spectrum.df %>%
filter(order == ordernum,
pixel >= pixel_lower - 50,
pixel <= pixel_upper + 50) %>%
ggplot(mapping = aes(x = lambda, y = flux_norm)) +
geom_vline(xintercept = (solar_spectrum.df %>% filter(order == ordernum,
pixel == pixel_lower))$lambda) +
geom_vline(xintercept = (solar_spectrum.df %>% filter(order == ordernum,
pixel == pixel_upper))$lambda) +
geom_point()
single_line.df%>%
#mutate(date = as.Date(date), date = as.numeric(date)) %>%
filter(date == "2021-06-20") %>%
ggplot(mapping = aes(x = pixel, y = flux_norm, color = date)) +
geom_point()
line_name = "line_5236.09361_57.h5"
#line_name = "line_6126.72717_74.h5"
#line_name = "line_9864.45699_112.h5"
# download a single line
# (pixels,date)
single_line = H5Fopen(str_c(wd_data, line_name))
single_line
single_line$pixels
single_line$order_idx
single_line$fit_lambdac
# vector of dates
dates = single_line$dates
# vector of pixels
pixels = as.numeric( str_split_1(single_line$pixels,":") )
pixels = seq(pixels[1],pixels[2])
# create dataframe for dates and pixels
single_line.df = expand_grid(date = dates, pixel = pixels )
# set columns
single_line.df$flux = as.vector( single_line$flux)
single_line.df$flux_norm = as.vector( single_line$flux_norm)
single_line.df$lambda = as.vector( single_line$lambda)
single_line.df$var = as.vector( single_line$var)
single_line.df$var_norm = as.vector( single_line$var_norm)
rm(dates, pixels)
solar_spectrum.df %>% filter(order == "order57",pixel == 2491)
single_line.df %>% filter(pixel == 2491)
single_line.df%>%
ggplot(mapping = aes(x = date, y = flux_norm, color = date)) +
geom_point()
single_line.df%>%
ggplot(mapping = aes(x = date, y = flux_norm)) +
geom_point()
single_line.df%>%
mutate(date = as.Date(date)) %>%
ggplot(mapping = aes(x = date, y = flux_norm)) +
geom_point()
single_line.df%>%
mutate(date = as.Date(date)) %>%
ggplot(mapping = aes(x = date, y = flux_norm, color = pixel)) +
geom_point()
single_line.df%>%
mutate(date = as.Date(date)) %>%
ggplot(mapping = aes(x = date, y = flux_norm, color = pixel)) +
geom_point() +
geom_line()
single_line.df%>%
mutate(date = as.Date(date)) %>%
ggplot(mapping = aes(x = date, y = flux_norm, color = pixel)) +
geom_point()
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(stringr)
library(MASS)
library(rhdf5)
## Data directory
wd_data = "/Users/josephsalzer/research/exostat/"
# download solar spectrum, with flux, flux_norm, lambda, var, and var_norm
# (pixels,order_idx)
solar_spectrum = H5Fopen(str_c(wd_data, "solar_spectrum_ex.h5"))
solar_spectrum
solar_spectrum$flux_norm[1:6,1:10]
# number of pixels and orders
num_pixels = dim(solar_spectrum$flux)[1]
num_orders = dim(solar_spectrum$flux)[2]
# vector of orders and pixels
orders = seq(1,num_orders) %>% map_chr( \(x) str_c("order",x) )
pixels = seq(1,num_pixels)
# create dataframe for orders and pixels
solar_spectrum.df = expand_grid(order = orders, pixel = pixels)
# set columns
solar_spectrum.df$flux_norm = as.vector(solar_spectrum$flux_norm)
solar_spectrum.df$flux = as.vector(solar_spectrum$flux)
solar_spectrum.df$lambda = as.vector(solar_spectrum$lambda)
solar_spectrum.df$var = as.vector(solar_spectrum$var)
solar_spectrum.df$var_norm = as.vector(solar_spectrum$var_norm)
# remove some vectors
rm(orders, pixels, num_orders, num_pixels)
solar_spectrum.df
line_name = "line_5236.09361_57.h5"
#line_name = "line_6126.72717_74.h5"
#line_name = "line_9864.45699_112.h5"
# download a single line
# (pixels,date)
single_line = H5Fopen(str_c(wd_data, line_name))
single_line
single_line$pixels
single_line$order_idx
single_line$fit_lambdac
# vector of dates
dates = single_line$dates
# vector of pixels
pixels = as.numeric( str_split_1(single_line$pixels,":") )
pixels = seq(pixels[1],pixels[2])
# create dataframe for dates and pixels
single_line.df = expand_grid(date = dates, pixel = pixels )
# set columns
single_line.df$flux = as.vector( single_line$flux)
single_line.df$flux_norm = as.vector( single_line$flux_norm)
single_line.df$lambda = as.vector( single_line$lambda)
single_line.df$var = as.vector( single_line$var)
single_line.df$var_norm = as.vector( single_line$var_norm)
rm(dates, pixels)
solar_spectrum.df %>% filter(order == "order57",pixel == 2491)
single_line.df %>% filter(pixel == 2491)
solar_spectrum.df %>%
filter(order == "order52") %>%
ggplot(mapping = aes(x = lambda, y = flux)) +
geom_point()
solar_spectrum.df %>%
filter(order == "order52") %>%
ggplot(mapping = aes(x = lambda, y = flux_norm)) +
geom_point()
# lower and upper pixel
pixel_lower = as.numeric( str_split_1(single_line$pixels,":")[1] )
pixel_upper = as.numeric( str_split_1(single_line$pixels,":")[2] )
ordernum = str_c("order",single_line$order_idx)
solar_spectrum.df %>%
filter(order == ordernum,
pixel >= pixel_lower - 50,
pixel <= pixel_upper + 50) %>%
ggplot(mapping = aes(x = lambda, y = flux_norm)) +
geom_vline(xintercept = (solar_spectrum.df %>% filter(order == ordernum,
pixel == pixel_lower))$lambda) +
geom_vline(xintercept = (solar_spectrum.df %>% filter(order == ordernum,
pixel == pixel_upper))$lambda) +
geom_point()
rm(pixel_lower, pixel_upper, ordernum)
single_line.df%>%
#mutate(date = as.Date(date), date = as.numeric(date)) %>%
filter(date == "2021-06-20") %>%
ggplot(mapping = aes(x = pixel, y = flux_norm, color = date)) +
geom_point()
single_line.df%>%
mutate(date = as.Date(date)) %>%
ggplot(mapping = aes(x = date, y = flux_norm, color = pixel)) +
geom_point()
single_line.df %>% filter(pixel == 2491) %>% summarise(lambda)
summarize( (single_line.df %>% filter(pixel == 2491) )$lambda )
single_line.df %>% filter(pixel == 2491) %>% group_by(lambda) %>% mutate(min_lam = min(lambda),
max_lam = max(lambda))
single_line.df %>% filter(pixel == 2491) %>% mutate(min_lam = min(lambda),
max_lam = max(lambda))
single_line.df %>% filter(pixel == 2491)
line_name = "line_5236.09361_57.h5"
#line_name = "line_6126.72717_74.h5"
#line_name = "line_9864.45699_112.h5"
# download a single line
# (pixels,date)
single_line = H5Fopen(str_c(wd_data, line_name))
single_line
single_line$pixels
single_line$order_idx
single_line$fit_lambdac
#line_name = "line_5236.09361_57.h5"
#line_name = "line_6126.72717_74.h5"
line_name = "line_9864.45699_112.h5"
# download a single line
# (pixels,date)
single_line = H5Fopen(str_c(wd_data, line_name))
single_line
single_line$pixels
single_line$order_idx
single_line$fit_lambdac
# vector of dates
dates = single_line$dates
# vector of pixels
pixels = as.numeric( str_split_1(single_line$pixels,":") )
pixels = seq(pixels[1],pixels[2])
# create dataframe for dates and pixels
single_line.df = expand_grid(date = dates, pixel = pixels )
# set columns
single_line.df$flux = as.vector( single_line$flux)
single_line.df$flux_norm = as.vector( single_line$flux_norm)
single_line.df$lambda = as.vector( single_line$lambda)
single_line.df$var = as.vector( single_line$var)
single_line.df$var_norm = as.vector( single_line$var_norm)
rm(dates, pixels)
# lower and upper pixel
pixel_lower = as.numeric( str_split_1(single_line$pixels,":")[1] )
pixel_upper = as.numeric( str_split_1(single_line$pixels,":")[2] )
ordernum = str_c("order",single_line$order_idx)
solar_spectrum.df %>%
filter(order == ordernum,
pixel >= pixel_lower - 50,
pixel <= pixel_upper + 50) %>%
ggplot(mapping = aes(x = lambda, y = flux_norm)) +
geom_vline(xintercept = (solar_spectrum.df %>% filter(order == ordernum,
pixel == pixel_lower))$lambda) +
geom_vline(xintercept = (solar_spectrum.df %>% filter(order == ordernum,
pixel == pixel_upper))$lambda) +
geom_point()
