ggtitle("2021-01-01")
line_df %>%
filter(date == "2021-01-01") %>%
ggplot() +
geom_point(mapping = aes(x = pixel, y = flux_norm)) +
ggtitle("2021-01-01")
ggsave("line_on_one_day.png")
line_df %>%
filter(pixel %in% c(4480,4481)) %>%
ggplot() +
geom_point(mapping = aes(x = date, y = flux_norm, color = pixel))
line_df %>%
filter(pixel %in% c(4480,4481)) %>%
ggplot() +
geom_point(mapping = aes(x = date, y = flux_norm, color = as.factor(pixel) ))
line_df %>%
filter(pixel %in% c(4480,4481)) %>%
ggplot() +
geom_point(mapping = aes(x = date, y = flux_norm, color = as.factor(pixel) )) +
guides(fill=guide_legend(title="Pixel Number"))
line_df %>%
filter(pixel %in% c(4480,4481)) %>%
ggplot() +
geom_point(mapping = aes(x = date, y = flux_norm, color = as.factor(pixel) )) +
guides(color=guide_legend(title="Pixel Number"))
line_df %>%
filter(pixel %in% c(4480,4481)) %>%
ggplot() +
geom_point(mapping = aes(x = date, y = flux_norm, color = as.factor(pixel) )) +
guides(color=guide_legend(title="Pixel Number"))
line_df %>%
filter(pixel %in% c(4480,4481))
line_df %>%
filter(pixel %in% c(4480,4481)) %>%
ggplot() +
geom_point(mapping = aes(x = date, y = flux_norm, color = as.factor(pixel) )) +
guides(color=guide_legend(title="Pixel Number"))
line_df %>%
filter(pixel %in% c(4480,4481)) %>%
group_by(pixel) %>%
summarize(flux_norm = cor(flux_norm))
line_df %>%
filter(pixel %in% c(4480,4481)) %>%
ggplot() +
geom_point(mapping = aes(x = date, y = flux_norm, color = as.factor(pixel) )) +
guides(color=guide_legend(title="Pixel Number"))
line_df %>%
filter(pixel %in% c(4480,4481)) %>%
group_by(pixel) %>%
summarize(cor_flux_norm = cor(flux_norm) )
line_df %>%
filter(pixel %in% c(4480,4481)) %>%
ggplot() +
geom_point(mapping = aes(x = date, y = flux_norm, color = as.factor(pixel) )) +
guides(color=guide_legend(title="Pixel Number"))
line_df %>%
filter(pixel == 4480) %>% pull(flux_norm)
cor( line_df %>% filter(pixel == 4480) %>% pull(flux_norm),
line_df %>% filter(pixel == 4481) %>% pull(flux_norm))
line_df %>%
filter(pixel %in% c(4480,4481)) %>%
ggplot() +
geom_point(mapping = aes(x = date, y = flux_norm, color = as.factor(pixel) )) +
guides(color=guide_legend(title="Pixel Number"))
cor( line_df %>% filter(pixel == 4480) %>% pull(flux_norm),
line_df %>% filter(pixel == 4481) %>% pull(flux_norm))
line_df %>%
filter(pixel %in% c(4460,4461)) %>%
ggplot() +
geom_point(mapping = aes(x = date, y = flux_norm, color = as.factor(pixel) )) +
guides(color=guide_legend(title="Pixel Number"))
line_df %>%
filter(pixel %in% c(4460,4461)) %>%
ggplot() +
geom_point(mapping = aes(x = date, y = flux_norm, color = as.factor(pixel) )) +
guides(color=guide_legend(title="Pixel Number"))
cor( line_df %>% filter(pixel == 4460) %>% pull(flux_norm),
line_df %>% filter(pixel == 4461) %>% pull(flux_norm))
x = 4461
line_df %>%
filter(pixel %in% c(x,x+1)) %>%
ggplot() +
geom_point(mapping = aes(x = date, y = flux_norm, color = as.factor(pixel) )) +
guides(color=guide_legend(title="Pixel Number"))
cor( line_df %>% filter(pixel == 4460) %>% pull(flux_norm),
line_df %>% filter(pixel == 4461) %>% pull(flux_norm))
rm(x)
x = 4462
line_df %>%
filter(pixel %in% c(x,x+1)) %>%
ggplot() +
geom_point(mapping = aes(x = date, y = flux_norm, color = as.factor(pixel) )) +
guides(color=guide_legend(title="Pixel Number"))
cor( line_df %>% filter(pixel == 4460) %>% pull(flux_norm),
line_df %>% filter(pixel == 4461) %>% pull(flux_norm))
rm(x)
x = 4463
line_df %>%
filter(pixel %in% c(x,x+1)) %>%
ggplot() +
geom_point(mapping = aes(x = date, y = flux_norm, color = as.factor(pixel) )) +
guides(color=guide_legend(title="Pixel Number"))
cor( line_df %>% filter(pixel == 4460) %>% pull(flux_norm),
line_df %>% filter(pixel == 4461) %>% pull(flux_norm))
rm(x)
x = 4464
line_df %>%
filter(pixel %in% c(x,x+1)) %>%
ggplot() +
geom_point(mapping = aes(x = date, y = flux_norm, color = as.factor(pixel) )) +
guides(color=guide_legend(title="Pixel Number"))
cor( line_df %>% filter(pixel == 4460) %>% pull(flux_norm),
line_df %>% filter(pixel == 4461) %>% pull(flux_norm))
rm(x)
x = 4465
line_df %>%
filter(pixel %in% c(x,x+1)) %>%
ggplot() +
geom_point(mapping = aes(x = date, y = flux_norm, color = as.factor(pixel) )) +
guides(color=guide_legend(title="Pixel Number"))
cor( line_df %>% filter(pixel == 4460) %>% pull(flux_norm),
line_df %>% filter(pixel == 4461) %>% pull(flux_norm))
rm(x)
x = 4466
line_df %>%
filter(pixel %in% c(x,x+1)) %>%
ggplot() +
geom_point(mapping = aes(x = date, y = flux_norm, color = as.factor(pixel) )) +
guides(color=guide_legend(title="Pixel Number"))
cor( line_df %>% filter(pixel == 4460) %>% pull(flux_norm),
line_df %>% filter(pixel == 4461) %>% pull(flux_norm))
rm(x)
x = 4467
line_df %>%
filter(pixel %in% c(x,x+1)) %>%
ggplot() +
geom_point(mapping = aes(x = date, y = flux_norm, color = as.factor(pixel) )) +
guides(color=guide_legend(title="Pixel Number"))
cor( line_df %>% filter(pixel == 4460) %>% pull(flux_norm),
line_df %>% filter(pixel == 4461) %>% pull(flux_norm))
rm(x)
x = 4440
line_df %>%
filter(pixel %in% c(x,x+1)) %>%
ggplot() +
geom_point(mapping = aes(x = date, y = flux_norm, color = as.factor(pixel) )) +
guides(color=guide_legend(title="Pixel Number"))
cor( line_df %>% filter(pixel == 4460) %>% pull(flux_norm),
line_df %>% filter(pixel == 4461) %>% pull(flux_norm))
rm(x)
x = 4430
line_df %>%
filter(pixel %in% c(x,x+1)) %>%
ggplot() +
geom_point(mapping = aes(x = date, y = flux_norm, color = as.factor(pixel) )) +
guides(color=guide_legend(title="Pixel Number"))
cor( line_df %>% filter(pixel == 4460) %>% pull(flux_norm),
line_df %>% filter(pixel == 4461) %>% pull(flux_norm))
rm(x)
x = 44410
line_df %>%
filter(pixel %in% c(x,x+1)) %>%
ggplot() +
geom_point(mapping = aes(x = date, y = flux_norm, color = as.factor(pixel) )) +
guides(color=guide_legend(title="Pixel Number"))
cor( line_df %>% filter(pixel == 4460) %>% pull(flux_norm),
line_df %>% filter(pixel == 4461) %>% pull(flux_norm))
rm(x)
x = 4520
line_df %>%
filter(pixel %in% c(x,x+1)) %>%
ggplot() +
geom_point(mapping = aes(x = date, y = flux_norm, color = as.factor(pixel) )) +
guides(color=guide_legend(title="Pixel Number"))
cor( line_df %>% filter(pixel == 4460) %>% pull(flux_norm),
line_df %>% filter(pixel == 4461) %>% pull(flux_norm))
rm(x)
x = 4520
line_df %>%
filter(pixel %in% c(x,x+1)) %>%
ggplot() +
geom_point(mapping = aes(x = date, y = flux_norm, color = as.factor(pixel) )) +
guides(color=guide_legend(title="Pixel Number"))
cor( line_df %>% filter(pixel == x) %>% pull(flux_norm),
line_df %>% filter(pixel == x+1) %>% pull(flux_norm))
rm(x)
x = 4521
line_df %>%
filter(pixel %in% c(x,x+1)) %>%
ggplot() +
geom_point(mapping = aes(x = date, y = flux_norm, color = as.factor(pixel) )) +
guides(color=guide_legend(title="Pixel Number"))
cor( line_df %>% filter(pixel == x) %>% pull(flux_norm),
line_df %>% filter(pixel == x+1) %>% pull(flux_norm))
rm(x)
x = 4523
line_df %>%
filter(pixel %in% c(x,x+1)) %>%
ggplot() +
geom_point(mapping = aes(x = date, y = flux_norm, color = as.factor(pixel) )) +
guides(color=guide_legend(title="Pixel Number"))
cor( line_df %>% filter(pixel == x) %>% pull(flux_norm),
line_df %>% filter(pixel == x+1) %>% pull(flux_norm))
rm(x)
x = 4524
line_df %>%
filter(pixel %in% c(x,x+1)) %>%
ggplot() +
geom_point(mapping = aes(x = date, y = flux_norm, color = as.factor(pixel) )) +
guides(color=guide_legend(title="Pixel Number"))
cor( line_df %>% filter(pixel == x) %>% pull(flux_norm),
line_df %>% filter(pixel == x+1) %>% pull(flux_norm))
rm(x)
x = 4525
line_df %>%
filter(pixel %in% c(x,x+1)) %>%
ggplot() +
geom_point(mapping = aes(x = date, y = flux_norm, color = as.factor(pixel) )) +
guides(color=guide_legend(title="Pixel Number"))
cor( line_df %>% filter(pixel == x) %>% pull(flux_norm),
line_df %>% filter(pixel == x+1) %>% pull(flux_norm))
rm(x)
x = 4526
line_df %>%
filter(pixel %in% c(x,x+1)) %>%
ggplot() +
geom_point(mapping = aes(x = date, y = flux_norm, color = as.factor(pixel) )) +
guides(color=guide_legend(title="Pixel Number"))
cor( line_df %>% filter(pixel == x) %>% pull(flux_norm),
line_df %>% filter(pixel == x+1) %>% pull(flux_norm))
rm(x)
x = 4527
line_df %>%
filter(pixel %in% c(x,x+1)) %>%
ggplot() +
geom_point(mapping = aes(x = date, y = flux_norm, color = as.factor(pixel) )) +
guides(color=guide_legend(title="Pixel Number"))
cor( line_df %>% filter(pixel == x) %>% pull(flux_norm),
line_df %>% filter(pixel == x+1) %>% pull(flux_norm))
rm(x)
x = 4528
line_df %>%
filter(pixel %in% c(x,x+1)) %>%
ggplot() +
geom_point(mapping = aes(x = date, y = flux_norm, color = as.factor(pixel) )) +
guides(color=guide_legend(title="Pixel Number"))
cor( line_df %>% filter(pixel == x) %>% pull(flux_norm),
line_df %>% filter(pixel == x+1) %>% pull(flux_norm))
rm(x)
x = 4529
line_df %>%
filter(pixel %in% c(x,x+1)) %>%
ggplot() +
geom_point(mapping = aes(x = date, y = flux_norm, color = as.factor(pixel) )) +
guides(color=guide_legend(title="Pixel Number"))
cor( line_df %>% filter(pixel == x) %>% pull(flux_norm),
line_df %>% filter(pixel == x+1) %>% pull(flux_norm))
rm(x)
line_df$pixel
min(line_df$pixel)
for (x in min(line_df$pixel):(max(line_df$pixel)-1) ) {
print(x)
}
for (x in min(line_df$pixel):(max(line_df$pixel)-1) ) {
#print(x)
}
pixels = min(line_df$pixel):(max(line_df$pixel)-1)
cor = rep(NA,length(pixels))
for (i in 1:length(pixels) ) {
cor[i] = cor( line_df %>% filter(pixel == pixels[i]) %>% pull(flux_norm),
line_df %>% filter(pixel == pixels[i]+1) %>% pull(flux_norm))
}
pixels = min(line_df$pixel):(max(line_df$pixel)-1)
cor = rep(NA,length(pixels))
for (i in 1:length(pixels) ) {
cor[i] = cor( line_df %>% filter(pixel == pixels[i]) %>% pull(flux_norm),
line_df %>% filter(pixel == pixels[i]+1) %>% pull(flux_norm))
}
ggplot() +
geom_point(mapping = aes(x = pixels, y = cor))
line_df %>%
filter(date == "2021-01-01") %>%
ggplot() +
geom_point(mapping = aes(x = pixel, y = flux_norm)) +
geom_point(mapping = aes(x = pixels, y = cor), color = "red")
line_df %>%
filter(date == "2021-01-01") %>%
ggplot() +
geom_point(mapping = aes(x = pixel, y = flux_norm)) +
geom_point(mapping = aes(x = pixels, y = cor), color = "red") +
ggtitle("2021-01-01")
# example line
i = 200
line_df = loadLineFile( line_list[i], wd_data = str_c(wd,"raw_spectrum_files/") )
line_df %>%
filter(date == "2021-01-01") %>%
ggplot() +
geom_point(mapping = aes(x = pixel, y = flux_norm)) +
ggtitle("2021-01-01")
ggsave("line_on_one_day.png")
# example line
i = 300
line_df %>%
filter(date == "2021-01-01") %>%
ggplot() +
geom_point(mapping = aes(x = pixel, y = flux_norm)) +
ggtitle("2021-01-01")
ggsave("line_on_one_day.png")
# example line
i = 400
line_df = loadLineFile( line_list[i], wd_data = str_c(wd,"raw_spectrum_files/") )
# example line
i = 400
line_df = loadLineFile( line_list[i], wd_data = str_c(wd,"raw_spectrum_files/") )
line_df %>%
filter(date == "2021-01-01") %>%
ggplot() +
geom_point(mapping = aes(x = pixel, y = flux_norm)) +
ggtitle("2021-01-01")
ggsave("line_on_one_day.png")
line_list
knitr::opts_chunk$set(echo = TRUE)
source("readSpectra.R")
# working directory
wd = "/Users/josephsalzer/research/exostat/"
# list of files in raw_spectrum_files
raw_spectrum_file_list = list.files(str_c(wd,"raw_spectrum_files"), pattern = ".h5")
# list of solar spectrum files
solarspectrum_list = raw_spectrum_file_list[!is.na( str_extract(raw_spectrum_file_list,"solar_spectrum") )]
# get dates for solar spectrum
all_dates = str_sub( str_split_fixed(solarspectrum_list,"_",n=3)[,3], end = -4 )
# list of line files
line_list = raw_spectrum_file_list[!is.na( str_extract(raw_spectrum_file_list,"line") )]
# get line-orders
all_lineorders = str_sub( str_split_fixed(line_list,"_",n=2)[,2], end = -4 )
# list of line property files
lineProp_list = list.files(str_c(wd,"line_property_files"), pattern = ".h5")
# get line-orders, from line property (shape) files
all_lineorders_prop = str_sub( str_split_fixed(lineProp_list,"_",n=2)[,2], end = -8 )
# list of line property files
bisector_list = list.files(str_c(wd,"bisector"), pattern = ".h5")
# number of spectra
length(solarspectrum_list)
# number of lines within spectra
length(line_list)
# number of lines from line property files
length(all_lineorders_prop)
knitr::opts_chunk$set(echo = TRUE)
source("readSpectra.R")
# working directory
wd = "/Users/josephsalzer/research/exostat/"
# list of files in raw_spectrum_files
raw_spectrum_file_list = list.files(str_c(wd,"raw_spectrum_files"), pattern = ".h5")
# list of solar spectrum files
solarspectrum_list = raw_spectrum_file_list[!is.na( str_extract(raw_spectrum_file_list,"solar_spectrum") )]
# get dates for solar spectrum
all_dates = str_sub( str_split_fixed(solarspectrum_list,"_",n=3)[,3], end = -4 )
# list of line files
line_list = raw_spectrum_file_list[!is.na( str_extract(raw_spectrum_file_list,"line") )]
# get line-orders
all_lineorders = str_sub( str_split_fixed(line_list,"_",n=2)[,2], end = -4 )
# list of line property files
lineProp_list = list.files(str_c(wd,"line_property_files"), pattern = ".h5")
# get line-orders, from line property (shape) files
all_lineorders_prop = str_sub( str_split_fixed(lineProp_list,"_",n=2)[,2], end = -8 )
# list of line property files
bisector_list = list.files(str_c(wd,"bisector"), pattern = ".h5")
# number of spectra
length(solarspectrum_list)
# number of lines within spectra
length(line_list)
# number of lines from line property files
length(all_lineorders_prop)
solarspectrum_list[1]
spectra_df = na.omit(
loadSolarFile(solarspectrum_list[1], wd_data = str_c(wd,"raw_spectrum_files/")) %>%
filter(order == 63)
)
for (i in c(2:length(solarspectrum_list))) {
if (i%%20 == 0) print(i)
spectrum_date = solarspectrum_list[i]
spectra_df = rbind(spectra_df,
na.omit(
loadSolarFile(spectrum_date, wd_data = str_c(wd,"raw_spectrum_files/")) %>%
filter(order == 63)
)
)
}
spectra_df
spectra_df %>%
filter(date == "2021-01-01") %>%
ggplot() +
geom_point(mapping = aes(x = pixel, y = flux_norm ))
spectra_df %>%
filter(date == "2021-01-01") %>%
filter(pixel <= 5000, pixel >= 2500)
spectr_2500_5000 = spectra_df %>%
filter(date == "2021-01-01") %>%
filter(pixel <= 5000, pixel >= 2500)
spectr_2500_5000 = spectra_df %>%
filter(date == "2021-01-01") %>%
filter(pixel <= 5000, pixel >= 2500)
pixels = min(spectr_2500_5000$pixel):(max(spectr_2500_5000$pixel)-1)
cor = rep(NA,length(pixels))
for (i in 1:length(pixels) ) {
cor[i] = cor( spectr_2500_5000 %>% filter(pixel == pixels[i]) %>% pull(flux_norm),
spectr_2500_5000 %>% filter(pixel == pixels[i]+1) %>% pull(flux_norm))
}
ggplot() +
geom_point(mapping = aes(x = pixels, y = cor))
pixels
cor
pixels
spectr_2500_5000 %>% filter(pixel == pixels[i]) %>% pull(flux_norm)
spectr_2500_5000 = spectra_df %>%
filter(pixel <= 5000, pixel >= 2500)
pixels = min(spectr_2500_5000$pixel):(max(spectr_2500_5000$pixel)-1)
cor = rep(NA,length(pixels))
for (i in 1:length(pixels) ) {
cor[i] = cor( spectr_2500_5000 %>% filter(pixel == pixels[i]) %>% pull(flux_norm),
spectr_2500_5000 %>% filter(pixel == pixels[i]+1) %>% pull(flux_norm))
}
ggplot() +
geom_point(mapping = aes(x = pixels, y = cor))
ggplot() +
geom_line(mapping = aes(x = pixels, y = cor))
ggplot() +
geom_point(mapping = aes(x = pixels, y = cor))
ggplot() +
geom_point(mapping = aes(x = pixels, y = cor), size = .5)
# example line
i =
line_df = loadLineFile( line_list[i], wd_data = str_c(wd,"raw_spectrum_files/") )
# example line
i = 200
line_df = loadLineFile( line_list[i], wd_data = str_c(wd,"raw_spectrum_files/") )
line_df %>%
filter(date == "2021-01-01") %>%
ggplot() +
geom_point(mapping = aes(x = pixel, y = flux_norm)) +
ggtitle("2021-01-01")
ggsave("line_on_one_day.png")
# example line
i = 201
line_df = loadLineFile( line_list[i], wd_data = str_c(wd,"raw_spectrum_files/") )
line_df %>%
filter(date == "2021-01-01") %>%
ggplot() +
geom_point(mapping = aes(x = pixel, y = flux_norm)) +
ggtitle("2021-01-01")
ggsave("line_on_one_day.png")
line_df %>%
filter(pixel %in% c(4150,4151)) %>%
ggplot() +
geom_point(mapping = aes(x = date, y = flux_norm, color = as.factor(pixel) )) +
guides(color=guide_legend(title="Pixel Number"))
cor( line_df %>% filter(pixel == 4150) %>% pull(flux_norm),
line_df %>% filter(pixel == 4151) %>% pull(flux_norm))
line_df %>%
filter(date == "2021-01-01") %>%
ggplot() +
geom_point(mapping = aes(x = pixel, y = flux_norm)) +
ggtitle("2021-01-01") +
geom_vline(4150)
line_df %>%
filter(date == "2021-01-01") %>%
ggplot() +
geom_point(mapping = aes(x = pixel, y = flux_norm)) +
ggtitle("2021-01-01") +
geom_vline(xintercept = 4150)
ggsave("line_on_one_day.png")
line_df %>%
filter(date == "2021-01-01") %>%
ggplot() +
geom_point(mapping = aes(x = pixel, y = flux_norm)) +
ggtitle("2021-01-01") +
geom_vline(xintercept = 4150) +
geom_vline(xintercept = 4151)
ggsave("line_on_one_day.png")
line_df %>%
filter(date == "2021-01-01") %>%
ggplot() +
geom_point(mapping = aes(x = pixel, y = flux_norm)) +
ggtitle("Spectral line on 2021-01-01") +
geom_vline(xintercept = 4150) +
geom_vline(xintercept = 4151)
ggsave("line_on_one_day.png")
line_df %>%
filter(pixel %in% c(4150,4151)) %>%
ggplot() +
geom_point(mapping = aes(x = date, y = flux_norm, color = as.factor(pixel) )) +
guides(color=guide_legend(title="Pixel Number")) +
ggtitle("Time series of the norm flux for two adjacent pixels")
cor( line_df %>% filter(pixel == 4150) %>% pull(flux_norm),
line_df %>% filter(pixel == 4151) %>% pull(flux_norm))
line_df %>%
filter(pixel %in% c(4150,4151)) %>%
ggplot() +
geom_point(mapping = aes(x = date, y = flux_norm, color = as.factor(pixel) )) +
guides(color=guide_legend(title="Pixel Number")) +
ggtitle("Time series of the norm flux for two adjacent pixels")
ggsave("adj_pixels.png")
cor( line_df %>% filter(pixel == 4150) %>% pull(flux_norm),
line_df %>% filter(pixel == 4151) %>% pull(flux_norm))
ggplot() +
geom_point(mapping = aes(x = pixels, y = cor), size = .5) +
ggtitle("Correlation between pixel x and x+1 across many pixels, on a single order")
#ggsave("adj_pixels.png")
ggplot() +
geom_point(mapping = aes(x = pixels, y = cor), size = .5) +
ggtitle("Correlation between pixel x and x+1 across many pixels, on a single order")
ggsave("adj_pixels_order63.png")
